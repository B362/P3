clc; clear all; close all;

syms I1xx I1xy I1xz I1yx I1yy I1yz I1zx I1zy I1zz
syms I2xx I2xy I2xz I2yx I2yy I2yz I2zx I2zy I2zz
syms theta1(i) theta2(i) theta3(i)
syms theta1(t) theta2(t) theta3(t)
syms dtheta1(i) dtheta2(i) dtheta3(i)
syms d1 d2 l1 l2 m1 m2

M = [(1/2)*(2*I1zz+2*I2zz+d2.^2*m2+l1.^2*m2+l1.^2*m2*cos(2*theta2( ...
  t))+2*d2*l1*m2*cos(theta3(i))+d2.^2*m2*cos(2*(theta2(i)+theta3(i)))+2* ...
  d2*l1*m2*cos(2*theta2(i)+theta3(i))),(1/2)*((-1)*(I1yz+I1zy+I2yz+ ...
  I2zy)*cos(theta1(i))+(I1xz+I1zx+I2xz+I2zx)*sin(theta1(i))),(1/2)*((-1) ...
  *(I2yz+I2zy)*cos(theta1(i))+(I2xz+I2zx)*sin(theta1(i)));(1/2)*((-1)*( ...
  I1yz+I1zy+I2yz+I2zy)*cos(theta1(i))+(I1xz+I1zx+I2xz+I2zx)*sin(theta1(i)) ...
  ),(1/2)*(I1xx+I1yy+I2xx+I2yy+2*d2.^2*m2+2*l1.^2*m2+((-1)* ...
  I1xx+I1yy+(-1)*I2xx+I2yy)*cos(2*theta1(i))+4*d2*l1*m2*cos(theta3(i) ...
  )+(-1)*I1xy*sin(2*theta1(i))+(-1)*I1yx*sin(2*theta1(i))+(-1)*I2xy* ...
  sin(2*theta1(i))+(-1)*I2yx*sin(2*theta1(i))),(1/2)*(I2xx+I2yy+2* ...
  d2.^2*m2+((-1)*I2xx+I2yy)*cos(2*theta1(i))+2*d2*l1*m2*cos(theta3( ...
  t))+(-1)*I2xy*sin(2*theta1(i))+(-1)*I2yx*sin(2*theta1(i)));(1/2)*(( ...
  -1)*(I2yz+I2zy)*cos(theta1(i))+(I2xz+I2zx)*sin(theta1(i))),(1/2)*( ...
  I2xx+I2yy+2*d2.^2*m2+((-1)*I2xx+I2yy)*cos(2*theta1(i))+2*d2* ...
  l1*m2*cos(theta3(i))+(-1)*I2xy*sin(2*theta1(i))+(-1)*I2yx*sin(2* ...
  theta1(i))),(1/2)*(I2xx+I2yy+2*d2.^2*m2+((-1)*I2xx+I2yy)*cos(2* ...
  theta1(i))+(-1)*(I2xy+I2yx)*sin(2*theta1(i)))]

C = [(-2)*m2*(l1*cos(theta2(i))+d2*cos(theta2(i)+theta3(i)))*((l1*sin(theta2(i)) ...
  +d2*sin(theta2(i)+theta3(i)))*dtheta2(i)+d2*sin(theta2(i)+theta3(i)) ...
  *dtheta3(i)),(1/2)*((I1xy+I1yx+I2xy+I2yx)*cos(2*theta1( ...
  t))+((-1)*I1xx+I1yy+(-1)*I2xx+I2yy)*sin(2*theta1(i)))* ...
  dtheta2 (i),(1/2)*((I2xy+I2yx)*cos(2*theta1(i))+((-1)*I2xx+I2yy)* ...
  sin(2*theta1(i)))*(2*dtheta2(i)+dtheta3(i));( ...
  1/2)*((I1xz+I1zx+I2xz+I2zx)*cos(theta1(i))+(I1yz+I1zy+I2yz+I2zy)* ...
  sin(theta1(i))+m2*(l1.^2*sin(2*theta2(i))+d2.^2*sin(2*(theta2(i)+theta3(i)))+ ...
  2*d2*l1*sin(2*theta2(i)+theta3(i))))*dtheta1(i)+(-1)*(( ...
  I1xy+I1yx+I2xy+I2yx)*cos(2*theta1(i))+((-1)*I1xx+I1yy+(-1)*I2xx+ ...
  I2yy)*sin(2*theta1(i)))*dtheta2(i)+(-1)*((I2xy+I2yx)* ...
  cos(2*theta1(i))+((-1)*I2xx+I2yy)*sin(2*theta1(i)))*dtheta3 ...
  (i),(-2)*d2*l1*m2*sin(theta3(i))*dtheta3(i),(-1)*d2* ...
  l1*m2*sin(theta3(i))*dtheta3(i);(1/2)*((I2xz+I2zx)*cos( ...
  theta1(i))+(I2yz+I2zy)*sin(theta1(i))+2*d2*m2*(l1*cos(theta2(i))+d2*cos( ...
  theta2(i)+theta3(i)))*sin(theta2(i)+theta3(i)))*dtheta1(i)+(-1)*(( ...
  I2xy+I2yx)*cos(2*theta1(i))+((-1)*I2xx+I2yy)*sin(2*theta1(i)))*( ...
  dtheta2(i)+dtheta3(i)),d2*l1*m2*sin(theta3(i)) ...
  *dtheta2(i),0]

G = [0,g*((d1*m1+l1*m2)*cos(theta2(i))+d2*m2*cos(theta2(i)+theta3(i))),d2* ...
  g*m2*cos(theta2(i)+theta3(i))]